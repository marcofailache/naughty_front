{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ivopascoal/Desktop/Naughty/naughty_front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ivopascoal/Desktop/Naughty/naughty_front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ivopascoal/Desktop/Naughty/naughty_front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/ivopascoal/Desktop/Naughty/naughty_front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import React,{useCallback,useState}from'react';import styled from'styled-components';import{Button,useModal}from'@pancakeswap-libs/uikit';import useI18n from'hooks/useI18n';import useGetLotteryHasDrawn from'hooks/useGetLotteryHasDrawn';import{useLotteryAllowance}from'hooks/useAllowance';import{useLotteryApprove}from'hooks/useApprove';import useTickets from'hooks/useTickets';import useTokenBalance from'hooks/useTokenBalance';import{getCakeAddress}from'utils/addressHelpers';import BuyTicketModal from'./BuyTicketModal';import MyTicketsModal from'./UserTicketsModal';import PurchaseWarningModal from'./PurchaseWarningModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CardActions=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  margin-top: \",\"px;\\n\\n  \",\" {\\n    justify-content: space-between;\\n  }\\n\"])),function(props){return props.theme.spacing[3];},function(_ref){var theme=_ref.theme;return theme.mediaQueries.lg;});var TicketCard=function TicketCard(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var TranslateString=useI18n();var allowance=useLotteryAllowance();var _useLotteryApprove=useLotteryApprove(),onApprove=_useLotteryApprove.onApprove;var lotteryHasDrawn=useGetLotteryHasDrawn();var cakeBalance=useTokenBalance(getCakeAddress());var tickets=useTickets();var ticketsLength=tickets.length;var _useModal=useModal(/*#__PURE__*/_jsx(MyTicketsModal,{myTicketNumbers:tickets,from:\"buy\"})),_useModal2=_slicedToArray(_useModal,1),onPresentMyTickets=_useModal2[0];var _useModal3=useModal(/*#__PURE__*/_jsx(PurchaseWarningModal,{})),_useModal4=_slicedToArray(_useModal3,1),onPresentApprove=_useModal4[0];var _useModal5=useModal(/*#__PURE__*/_jsx(BuyTicketModal,{max:cakeBalance,tokenName:\"CAKE\"})),_useModal6=_slicedToArray(_useModal5,1),onPresentBuy=_useModal6[0];var handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var txHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setRequestedApproval(true);_context.next=4;return onApprove();case 4:txHash=_context.sent;// user rejected tx or didn't go thru\nif(!txHash){setRequestedApproval(false);}onPresentApprove();_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);})),[onApprove,onPresentApprove]);var renderLotteryTicketButtons=function renderLotteryTicketButtons(){if(!allowance.toNumber()){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{fullWidth:true,disabled:true,children:TranslateString(432,'View your tickets')}),/*#__PURE__*/_jsx(Button,{fullWidth:true,disabled:requestedApproval,onClick:handleApprove,children:TranslateString(999,'Approve PASTA')})]});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{style:{marginRight:'8px'},fullWidth:true,disabled:ticketsLength===0,variant:\"secondary\",onClick:onPresentMyTickets,children:TranslateString(432,'View your tickets')}),/*#__PURE__*/_jsx(Button,{id:\"lottery-buy-start\",fullWidth:true,onClick:onPresentBuy,children:TranslateString(430,'Buy ticket')})]});};return/*#__PURE__*/_jsx(CardActions,{children:lotteryHasDrawn?/*#__PURE__*/_jsxs(Button,{disabled:true,children:[\" \",TranslateString(999,'On sale soon')]}):renderLotteryTicketButtons()});};export default TicketCard;","map":{"version":3,"sources":["/Users/ivopascoal/Desktop/Naughty/naughty_front/src/views/Lottery/components/TicketCard/TicketActions.tsx"],"names":["React","useCallback","useState","styled","Button","useModal","useI18n","useGetLotteryHasDrawn","useLotteryAllowance","useLotteryApprove","useTickets","useTokenBalance","getCakeAddress","BuyTicketModal","MyTicketsModal","PurchaseWarningModal","CardActions","div","props","theme","spacing","mediaQueries","lg","TicketCard","requestedApproval","setRequestedApproval","TranslateString","allowance","onApprove","lotteryHasDrawn","cakeBalance","tickets","ticketsLength","length","onPresentMyTickets","onPresentApprove","onPresentBuy","handleApprove","txHash","console","error","renderLotteryTicketButtons","toNumber","marginRight"],"mappings":"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","sourcesContent":["import React, { useCallback, useState } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Button, useModal } from '@pancakeswap-libs/uikit'\r\nimport useI18n from 'hooks/useI18n'\r\nimport useGetLotteryHasDrawn from 'hooks/useGetLotteryHasDrawn'\r\nimport { useLotteryAllowance } from 'hooks/useAllowance'\r\nimport { useLotteryApprove } from 'hooks/useApprove'\r\nimport useTickets from 'hooks/useTickets'\r\nimport useTokenBalance from 'hooks/useTokenBalance'\r\nimport { getCakeAddress } from 'utils/addressHelpers'\r\nimport BuyTicketModal from './BuyTicketModal'\r\nimport MyTicketsModal from './UserTicketsModal'\r\nimport PurchaseWarningModal from './PurchaseWarningModal'\r\n\r\nconst CardActions = styled.div`\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-top: ${(props) => props.theme.spacing[3]}px;\r\n\r\n  ${({ theme }) => theme.mediaQueries.lg} {\r\n    justify-content: space-between;\r\n  }\r\n`\r\n\r\nconst TicketCard: React.FC = () => {\r\n  const [requestedApproval, setRequestedApproval] = useState(false)\r\n  const TranslateString = useI18n()\r\n  const allowance = useLotteryAllowance()\r\n  const { onApprove } = useLotteryApprove()\r\n  const lotteryHasDrawn = useGetLotteryHasDrawn()\r\n  const cakeBalance = useTokenBalance(getCakeAddress())\r\n\r\n  const tickets = useTickets()\r\n  const ticketsLength = tickets.length\r\n  const [onPresentMyTickets] = useModal(<MyTicketsModal myTicketNumbers={tickets} from=\"buy\" />)\r\n  const [onPresentApprove] = useModal(<PurchaseWarningModal />)\r\n  const [onPresentBuy] = useModal(<BuyTicketModal max={cakeBalance} tokenName=\"CAKE\" />)\r\n\r\n  const handleApprove = useCallback(async () => {\r\n    try {\r\n      setRequestedApproval(true)\r\n      const txHash = await onApprove()\r\n      // user rejected tx or didn't go thru\r\n      if (!txHash) {\r\n        setRequestedApproval(false)\r\n      }\r\n      onPresentApprove()\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }, [onApprove, onPresentApprove])\r\n\r\n  const renderLotteryTicketButtons = () => {\r\n    if (!allowance.toNumber()) {\r\n      return (\r\n        <>\r\n          <Button fullWidth disabled>\r\n            {TranslateString(432, 'View your tickets')}\r\n          </Button>\r\n          <Button fullWidth disabled={requestedApproval} onClick={handleApprove}>\r\n            {TranslateString(999, 'Approve PASTA')}\r\n          </Button>\r\n        </>\r\n      )\r\n    }\r\n    return (\r\n      <>\r\n        <Button\r\n          style={{ marginRight: '8px' }}\r\n          fullWidth\r\n          disabled={ticketsLength === 0}\r\n          variant=\"secondary\"\r\n          onClick={onPresentMyTickets}\r\n        >\r\n          {TranslateString(432, 'View your tickets')}\r\n        </Button>\r\n        <Button id=\"lottery-buy-start\" fullWidth onClick={onPresentBuy}>\r\n          {TranslateString(430, 'Buy ticket')}\r\n        </Button>\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <CardActions>\r\n      {lotteryHasDrawn ? (\r\n        <Button disabled> {TranslateString(999, 'On sale soon')}</Button>\r\n      ) : (\r\n        renderLotteryTicketButtons()\r\n      )}\r\n    </CardActions>\r\n  )\r\n}\r\n\r\nexport default TicketCard\r\n"]},"metadata":{},"sourceType":"module"}